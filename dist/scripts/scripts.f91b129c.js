"use strict";angular.module("alexandriaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).constant("_",window._).value("FIREBASE_REF","https://mtgl.firebaseio.com/").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/collection/:collectionId",{templateUrl:"views/collection.html",controller:"CollectionCtrl",controllerAs:"collection"}).otherwise({redirectTo:"/"})}]),angular.module("alexandriaApp").controller("MainCtrl",["$scope","$firebaseArray","_","FIREBASE_REF",function(a,b,c,d){var e=new Firebase(d+"collections");a.collections=b(e),a.createCollection=function(){var b=a.collectionName,c=a.description,d=b.trim().toLowerCase().replace(/\s/g,"-").replace(/[^a-zA-Z0-9_.+-]/g,"");a.collections.$add({name:b,url:d,description:c}),a.collectionName="",a.description=""}}]),angular.module("alexandriaApp").controller("CollectionCtrl",["$scope","$firebaseObject","FIREBASE_REF","$routeParams","deckbrewAPI","_",function(a,b,c,d,e,f){function g(){a.whiteCards=[],a.redCards=[],a.blackCards=[],a.blueCards=[],a.greenCards=[],a.colorlessCards=[],a.multicolorCards=[]}function h(){g(),a.refItem&&a.refItem.cards&&f.each(a.refItem.cards,function(b){if(!b.colors||!b.colors.length)return void a.colorlessCards.push(b);if(b.colors.length>1)return void a.multicolorCards.push(b);switch(b.colors[0]){case"white":a.whiteCards.push(b);break;case"black":a.blackCards.push(b);break;case"blue":a.blueCards.push(b);break;case"red":a.redCards.push(b);break;case"green":a.greenCards.push(b);break;default:console.log("Could not find a collection for card:",b)}})}function i(){a.searchTerm?e.typeahead(a.searchTerm).success(function(b){a.searchResult=b}):a.searchResult&&(a.searchResult=[])}function j(b){f.remove(a.refItem.cards,function(a){return a.$$hashKey===b}),h()}var k=new Firebase(c+"collections/"+d.collectionId),l=b(k);l.$bindTo(a,"refItem"),g(),a.addCard=function(b){l.cards||(l.cards=[]),l.cards.push(b),l.$save(),a.clearSearch()},a.clearSearch=function(){a.searchTerm="",a.searchResult=[]},a.$on("EmittedEvent",function(b,c){a.$broadcast(c.name,c.data)}),a.$on("DeleteCard",function(a,b){j(b.$$hashKey)}),a.$watch("refItem",h),a.$watch("searchTerm",f.debounce(i,500))}]),angular.module("alexandriaApp").factory("deckbrewAPI",["$http",function(a){function b(b){return a.get(d+"cards/"+b)}function c(b){return a.get(d+"cards/typeahead?q="+b)}var d="https://api.deckbrew.com/mtg/";return{getCard:b,typeahead:c}}]),angular.module("alexandriaApp").directive("listItemCard",["_",function(a){return{template:'<li class="collection-card" ng-class="{ \'foil\': card.foil }">{{card.count}} <span ng-hide="showmenu" preview-attr="card">{{card.name}}</span><div class="card-mini-menu" ng-show="showmenu"><span class="glyphicon glyphicon-arrow-up" ng-click="increment()"></span><span class="glyphicon glyphicon-arrow-down" ng-click="decrement()"></span><span class="glyphicon glyphicon-certificate" ng-click="toggleFoil()"></span><span class="glyphicon glyphicon-remove" ng-click="deleteCard()"></span></div><span class="glyphicon glyphicon-cog" ng-click="toggleMenu()"></span></li>',restrict:"E",scope:{card:"=cardData"},link:function(b,c){b.showmenu=!1,b.card.count=b.card.count||1,b.card.foil="undefined"==typeof b.card.foil?!1:b.card.foil,b.hideCmc=a.contains(b.card.types,"land");var d=a.reject(b.card.editions,{multiverse_id:0});b.rarity=d[0].rarity,b.toggleMenu=function(){b.showmenu=!b.showmenu},b.increment=function(){b.card.count++},b.decrement=function(){b.card.count>1&&b.card.count--},b.toggleFoil=function(){b.card.foil=!b.card.foil},b.deleteCard=function(){c.remove(),b.$emit("DeleteCard",b.card)}}}}]),angular.module("alexandriaApp").directive("cardList",["customTypeFilter",function(a){return{template:'<div><div class="card-list-title">{{title}}</div><ul class="card-list"><list-item-card ng-repeat="card in filteredCards" card-data="card" /></ul></div>',restrict:"E",scope:{cards:"="},link:function(b,c,d){var e=d.typeName;b.title=d.title,b.$watch("cards",function(c){c&&c.length&&(b.filteredCards=a(c,e))},!0)}}}]),angular.module("alexandriaApp").filter("customType",["_",function(a){return function(b,c){var d=a.filter(b,function(a){return a.types&&a.types[0]===c});return b=d}}]),angular.module("alexandriaApp").directive("cardPreview",["_",function(a){return{template:'<div class="preview-image">{{name}}</div>',restrict:"E",link:function(b,c){function d(a,b,d,g){var h=g?"inline":"none";c.css({"background-image":'url("'+a+'")',"background-size":"cover",left:b+e+"px",top:d+f+"px",display:h})}var e=20,f=-50;b.imageSource="",c.css({background:""}),b.$on("CardHover",function(b,c){if(c.card&&c.card.editions.length>1){var e=a.find(c.card.editions,function(a){return 0!==a.multiverse_id});d(e.image_url,c.x,c.y,!0)}else d(c.card.editions[0].image_url,c.x,c.y,!0)}),b.$on("CardHoverExit",function(){d("",0,0,!1)})}}}]),angular.module("alexandriaApp").directive("previewAttr",function(){return{restrict:"A",scope:{card:"&previewAttr"},link:function(a,b){b.on("mouseenter",function(b){if(!a.$parent||!a.$parent.showmenu){var c=a.card();a.$emit("EmittedEvent",{name:"CardHover",data:{card:c,x:b.pageX,y:b.pageY}})}}),b.on("mouseleave",function(){a.$emit("EmittedEvent",{name:"CardHoverExit"})})}}}),angular.module("alexandriaApp").run(["$templateCache",function(a){a.put("views/collection.html",'<div class="container-fluid center" ng-show="!refItem.name"> <div class="row marketing"> <h1> <span class="glyphicon glyphicon-cog glyphicon-spin"></span> </h1> </div> </div> <div class="container collection" ng-show="!!refItem.name"> <card-preview></card-preview> <div class="row"> <div class="col-md-8"> <h1>{{refItem.name}}</h1> </div> <div class="col-md-4 search-section"> <div class="search-wrapper"> <input class="padding-xs" type="text" ng-model="searchTerm" placeholder="Add card"> <a class="remove-search padding-xs" ng-click="clearSearch()"><span class="glyphicon glyphicon-remove"></span></a> </div> <ul class="ac-list"> <li ng-repeat="result in searchResult track by result.id" class="ac-hit" ng-cloak> <div class="ac-wrapper"> <div class="placeholder"><img ng-src="{{ result && result.editions[0].image_url || \'\' }}" preview-attr="result"></div> <span class="ac-name"> {{result.name}} </span> <button class="btn btn-xs btn-success" ng-click="addCard(result)">Add <span class="glyphicon glyphicon-plus"></span> </button> </div> </li> </ul> </div> </div> <div class="row marketing"> <div class="collection-section clearfix"> <div class="row"> <div class="color color-white"> <h3>White</h3> <card-list cards="whiteCards" title="Creatures" type-name="creature"></card-list> <card-list cards="whiteCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="whiteCards" title="Instants" type-name="instant"></card-list> <card-list cards="whiteCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-red"> <h3>Red</h3> <card-list cards="redCards" title="Creatures" type-name="creature"></card-list> <card-list cards="redCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="redCards" title="Instants" type-name="instant"></card-list> <card-list cards="redCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-blue"> <h3>Blue</h3> <card-list cards="blueCards" title="Creatures" type-name="creature"></card-list> <card-list cards="blueCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="blueCards" title="Instants" type-name="instant"></card-list> <card-list cards="blueCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-black"> <h3>Black</h3> <card-list cards="blackCards" title="Creatures" type-name="creature"></card-list> <card-list cards="blackCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="blackCards" title="Instants" type-name="instant"></card-list> <card-list cards="blackCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-green"> <h3>Green</h3> <card-list cards="greenCards" title="Creatures" type-name="creature"></card-list> <card-list cards="greenCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="greenCards" title="Instants" type-name="instant"></card-list> <card-list cards="greenCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-multi"> <h3>Multicolored</h3> <card-list cards="multicolorCards" title="Creatures" type-name="creature"></card-list> <card-list cards="multicolorCards" title="Sorceries" type-name="sorcery"></card-list> <card-list cards="multicolorCards" title="Instants" type-name="instant"></card-list> <card-list cards="multicolorCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> <div class="color color-colorless"> <h3>Colorless</h3> <card-list cards="colorlessCards" title="Creatures" type-name="creature"></card-list> <card-list cards="colorlessCards" title="Artifacts" type-name="artifact"></card-list> <card-list cards="colorlessCards" title="Lands" type-name="land"></card-list> <card-list cards="colorlessCards" title="Planeswalkers" type-name="planeswalker"></card-list> </div> </div> </div> </div> </div>'),a.put("views/main.html",'<div class="container"> <div class="jumbotron"> <h1>Create a collection</h1> <p class="lead"> Type a collection name for your MTG card collection: </p> <div class="form-horizontal"> <div class="form-group"> <div class="col-sm-4"></div> <div class="col-sm-4"> <input type="text" id="username" class="form-control" ng-model="collectionName" placeholder="Collection name" autofocus accept=""> </div> <div class="col-sm-4"></div> </div> <div class="form-group"> <div class="col-sm-4"></div> <div class="col-sm-4"> <input type="text" class="form-control" id="description" ng-model="description" placeholder="Optional description"> </div> <div class="col-sm-4"></div> </div> </div> <p> <button class="btn btn-lg btn-success" ng-disabled="!collectionName" ng-click="createCollection()">Create! <span class="glyphicon glyphicon-ok"></span> </button> </p> </div> </div> <div class="container-fluid center" ng-show="!collections.length"> <div class="row marketing"> <h1> <span class="glyphicon glyphicon-cog glyphicon-spin"></span> </h1> </div> </div> <div class="container" ng-show="!!collections.length"> Search: <input type="text" name="" id="" ng-model="query"> <table class="table table-striped"> <thead> <tr> <th> Name </th> <th> Description </th> <th> Cards </th> </tr> </thead> <tbody> <tr ng-repeat="collection in collections | filter:query | orderBy: \'name\'"> <td> <a href="#/collection/{{collection.$id}}">{{collection.name}}</a> </td> <td> {{collection.description}} </td> <td> {{collection.cards.length || 0}} </td> </tr> </tbody> </table> </div>')}]);