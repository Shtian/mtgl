"use strict";angular.module("alexandriaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).constant("_",window._).value("FIREBASE_REF","https://mtgl.firebaseio.com/").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/collection/:collectionId",{templateUrl:"views/collection.html",controller:"CollectionCtrl",controllerAs:"collection"}).otherwise({redirectTo:"/"})}]),angular.module("alexandriaApp").controller("MainCtrl",["$scope","$firebaseArray","_","FIREBASE_REF",function(a,b,c,d){var e=new Firebase(d+"collections");a.collections=b(e),a.createCollection=function(){if(a.isNameUnique()){var b=a.collectionName,c=b.trim().toLowerCase().replace(/\s/g,"-").replace(/[^a-zA-Z0-9_.+-]/g,"");a.collections.$add({name:b,url:c}),console.log("collection added",a.collectionName),a.collectionName=""}},a.isNameUnique=function(){var b=a.collectionName;return b?a.collections&&a.collections.length?!c.some(a.collection,{name:a.collectionName}):!0:!1}}]),angular.module("alexandriaApp").controller("CollectionCtrl",["$scope","$firebaseObject","FIREBASE_REF","$routeParams","deckbrewAPI","_",function(a,b,c,d,e,f){function g(){a.searchTerm&&e.typeahead(a.searchTerm).success(function(b){console.log(b),a.searchResult=b})}var h=new Firebase(c+"collections/"+d.collectionId),i=b(h);i.$bindTo(a,"refItem"),a.addCard=function(a){console.log(a),i.cards||(i.cards=[]),i.cards.push(a),i.$save()},a.$watch("searchTerm",f.debounce(g,500))}]),angular.module("alexandriaApp").factory("deckbrewAPI",["$http",function(a){function b(b){return a.get(d+"cards/"+b)}function c(b){return a.get(d+"cards/typeahead?q="+b)}var d="https://api.deckbrew.com/mtg/";return{getCard:b,typeahead:c}}]),angular.module("alexandriaApp").run(["$templateCache",function(a){a.put("views/collection.html",'<div class="container-fluid center" ng-show="!refItem.name"> <div class="row marketing"> <h1> <span class="glyphicon glyphicon-cog glyphicon-spin"></span> </h1> </div> </div> <div class="container-fluid" ng-show="!!refItem.name"> <div class="page-header"> <h1>{{refItem.name}}</h1> </div> <div class="row marketing"> <div class="col-md-8 collection-section clearfix"> <h2>My collection:</h2> <ul class="padding-s"> <li ng-repeat="card in refItem.cards" class="margin-tb-s padding-s" ng-cloak> {{card.name}} <img src="{{card.editions[0].image_url}}"> </li> </ul> </div> <div class="col-md-4 search-section"> <h2>Add card:</h2> <input type="text" ng-model="searchTerm"> <ul class="padding-s"> <li ng-repeat="result in searchResult" class="margin-tb-s"> {{result.name}} <button class="btn btn-xs btn-success" ng-click="addCard(result)">Add <span class="glyphicon glyphicon-plus"></span> </button> </li> </ul> </div> </div> </div>'),a.put("views/main.html",'<div class="container"> <div class="jumbotron"> <h1>Create a collection</h1> <p class="lead"> Start typing a unique collection name for which to bind your magic card collection to: </p> <p> <input type="text" class="username" ng-model="collectionName"> </p> <p> <button class="btn btn-lg btn-success" ng-disabled="!isNameUnique()" ng-click="createCollection()">Create! <span class="glyphicon glyphicon-ok"></span> </button> </p> </div> </div> <div class="container"> <table class="table table-striped"> <thead> <tr> <th> # </th> <th> Name </th> </tr> </thead> <tbody> <tr ng-repeat="collection in collections"> <th scope="row"> {{$index+1}} </th> <td> <a href="#/collection/{{collection.$id}}">{{collection.name}}</a> </td> </tr> </tbody> </table> </div>')}]);