"use strict";angular.module("alexandriaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).constant("_",window._).value("FIREBASE_REF","https://mtgl.firebaseio.com/").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/collection/:collectionId",{templateUrl:"views/collection.html",controller:"CollectionCtrl",controllerAs:"collection"}).otherwise({redirectTo:"/"})}]),angular.module("alexandriaApp").controller("MainCtrl",["$scope","$firebaseArray","_","FIREBASE_REF",function(a,b,c,d){var e=new Firebase(d+"collections");a.collections=b(e),a.createCollection=function(){if(a.isNameUnique()){var b=a.collectionName,c=b.trim().toLowerCase().replace(/\s/g,"-").replace(/[^a-zA-Z0-9_.+-]/g,"");a.collections.$add({name:b,url:c}),console.log("collection added",a.collectionName),a.collectionName=""}},a.isNameUnique=function(){var b=a.collectionName;return b?a.collections&&a.collections.length?!c.some(a.collection,{name:a.collectionName}):!0:!1}}]),angular.module("alexandriaApp").controller("CollectionCtrl",["$scope","$firebaseObject","FIREBASE_REF","$routeParams","deckbrewAPI","_",function(a,b,c,d,e,f){function g(){a.whiteCards=[],a.redCards=[],a.blackCards=[],a.blueCards=[],a.greenCards=[],a.colorlessCards=[],a.multicolorCards=[]}function h(){g(),a.refItem&&a.refItem.cards&&f.each(a.refItem.cards,function(b){if(!b.colors||!b.colors.length)return console.log("colorless"),void a.colorlessCards.push(b);if(b.colors.length>1)return console.log("multi"),void a.multicolorCards.push(b);switch(b.colors[0]){case"white":a.whiteCards.push(b);break;case"black":a.blackCards.push(b);break;case"blue":a.blueCards.push(b);break;case"red":a.redCards.push(b);break;case"green":a.greenCards.push(b);break;default:console.log("Could not find a collection for card:",b)}})}function i(){a.searchTerm?e.typeahead(a.searchTerm).success(function(b){a.searchResult=b}):a.searchResult=[]}var j=new Firebase(c+"collections/"+d.collectionId),k=b(j);k.$bindTo(a,"refItem"),g(),a.addCard=function(a){k.cards||(k.cards=[]),k.cards.push(a),k.$save()},a.clearSearch=function(){a.searchTerm="",a.searchResult=[]},a.$watch("refItem",h),a.$watch("searchTerm",f.debounce(i,500))}]),angular.module("alexandriaApp").factory("deckbrewAPI",["$http",function(a){function b(b){return a.get(d+"cards/"+b)}function c(b){return a.get(d+"cards/typeahead?q="+b)}var d="https://api.deckbrew.com/mtg/";return{getCard:b,typeahead:c}}]),angular.module("alexandriaApp").directive("listItemCard",["_",function(a){return{template:'<li class="collection-card"><span class="glyphicon glyphicon-certificate {{rarity}}"></span> <span ng-hide="hideCmc">({{card.cmc}}) </span>{{card.name}}</li>',restrict:"E",scope:{card:"=cardData"},link:function(b){b.hideCmc=a.contains(b.card.types,"land");var c=a.reject(b.card.editions,{multiverse_id:0});b.rarity=c[0].rarity}}}]),angular.module("alexandriaApp").directive("cardList",[function(){return{template:'<div ng-show="showList"><div class="card-list-title">{{title}}</div><ul class="card-list"><list-item-card ng-repeat="card in cards" card-data="card" /></ul></div>',restrict:"E",scope:{cards:"="},link:function(a,b,c){a.title=c.title,a.showList=!1;var d=a.$watch("cards",function(b){b&&b.length&&(a.showList=b.length,d())},!0)}}}]),angular.module("alexandriaApp").filter("typeFilter",["_",function(a){return function(b,c){return a.filter(b,function(a){return a.types&&a.types[0]===c})}}]),angular.module("alexandriaApp").run(["$templateCache",function(a){a.put("views/collection.html",'<div class="container-fluid center" ng-show="!refItem.name"> <div class="row marketing"> <h1> <span class="glyphicon glyphicon-cog glyphicon-spin"></span> </h1> </div> </div> <div class="container collection" ng-show="!!refItem.name"> <div class="row"> <div class="col-md-8"> <h1>{{refItem.name}}</h1> </div> <div class="col-md-4 search-section"> <input class="padding-xs" type="text" ng-model="searchTerm" placeholder="Add card"> <a class="remove-search padding-xs" ng-click="clearSearch()"><span class="glyphicon glyphicon-remove"></span></a> <ul class="ac-list"> <li ng-repeat="result in searchResult track by result.id" class="ac-hit"> <div class="ac-wrapper"> <div class="placeholder"><img src="{{result.editions[0].image_url}}"></div> <span class="ac-name"> {{result.name}} </span> <button class="btn btn-xs btn-success" ng-click="addCard(result)">Add <span class="glyphicon glyphicon-plus"></span> </button> </div> </li> </ul> </div> </div> <div class="row marketing"> <div class="collection-section clearfix"> <div class="row"> <div class="color color-white"> <h3>White</h3> <card-list cards="whiteCards | typeFilter:\'creature\'" title="Creatures"></card-list> </div> <div class="color color-red"> <h3>Red</h3> <card-list cards="redCards | typeFilter:\'creature\'" title="Creatures"> </div> <div class="color color-blue"> <h3>Blue</h3> <card-list cards="blueCards | typeFilter:\'creature\'" title="Creatures"> </div> <div class="color color-black"> <h3>Black</h3> <card-list cards="blackCards | typeFilter:\'creature\'" title="Creatures"> </div> <div class="color color-green"> <h3>Green</h3> <card-list cards="greenCards | typeFilter:\'creature\'" title="Creatures"> </div> <div class="color color-multi"> <h3>Multicolored</h3> <card-list cards="multicolorCards | typeFilter:\'creature\'" title="Creatures"> </div> <div class="color color-colorless"> <h3>Colorless</h3> <card-list cards="colorlessCards | typeFilter:\'creature\'" title="Creatures"> </div> </div> </div> </div> </div>'),a.put("views/main.html",'<div class="container"> <div class="jumbotron"> <h1>Create a collection</h1> <p class="lead"> Start typing a unique collection name for which to bind your magic card collection to: </p> <p> <input type="text" class="username" ng-model="collectionName"> </p> <p> <button class="btn btn-lg btn-success" ng-disabled="!isNameUnique()" ng-click="createCollection()">Create! <span class="glyphicon glyphicon-ok"></span> </button> </p> </div> </div> <div class="container"> <table class="table table-striped"> <thead> <tr> <th> # </th> <th> Name </th> </tr> </thead> <tbody> <tr ng-repeat="collection in collections"> <th scope="row"> {{$index+1}} </th> <td> <a href="#/collection/{{collection.$id}}">{{collection.name}}</a> </td> </tr> </tbody> </table> </div>')}]);